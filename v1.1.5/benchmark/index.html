<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Benchmark · JuliaNotes.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="JuliaNotes.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">JuliaNotes.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../startup/">REPL tips at startup.jl</a></li><li><a class="tocitem" href="../workflow/">Development workflow</a></li><li><a class="tocitem" href="../modules/">Modules and Revise</a></li><li><a class="tocitem" href="../loopscopes/">Scope of loops</a></li><li class="is-active"><a class="tocitem" href>Benchmark</a><ul class="internal"><li><a class="tocitem" href="#Simple-functions"><span>Simple functions</span></a></li><li><a class="tocitem" href="#Functions-that-modify-their-arguments"><span>Functions that modify their arguments</span></a></li></ul></li><li><a class="tocitem" href="../assignment/">Assignment and mutation</a></li><li><a class="tocitem" href="../instability/">Type instability</a></li><li><a class="tocitem" href="../anonymous/">Anonymous functions</a></li><li><a class="tocitem" href="../memory/">Tracking allocations</a></li><li><a class="tocitem" href="../immutable/">Mutability</a></li><li><a class="tocitem" href="../nomethod/">ERROR: No method...</a></li><li><a class="tocitem" href="../typevariance/">Vector{Int} &lt;: Vector{Real} is false???</a></li><li><a class="tocitem" href="../figures/">Figures and LaTeX</a></li><li><a class="tocitem" href="../new_package/">Create new package</a></li><li><a class="tocitem" href="../publish_docs/">Publish Docs</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Benchmark</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Benchmark</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/m3g/JuliaNotes.jl/blob/main/docs/src/benchmark.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Benchmarking"><a class="docs-heading-anchor" href="#Benchmarking">Benchmarking</a><a id="Benchmarking-1"></a><a class="docs-heading-anchor-permalink" href="#Benchmarking" title="Permalink"></a></h1><h2 id="Simple-functions"><a class="docs-heading-anchor" href="#Simple-functions">Simple functions</a><a id="Simple-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Simple-functions" title="Permalink"></a></h2><p>In general, function can be benchmarked with the <code>BenchmarkTools</code> package:</p><pre><code class="language-julia hljs">using BenchmarkTools
@btime f($x)
</code></pre><p>or</p><pre><code class="nohighlight hljs">@benchmark f($x)</code></pre><p>It is important to interpolate the variables of the input function, with the <code>$</code>. This is because the macros will then expand the variables into their values on parsing the expression, and the time for that operation does not affect the benchmark anymore.   </p><p>The macros <code>@btime</code> and <code>@benchmark</code> generally sample the execution of the function multiple times. Each sample is composed of many function evaluations, and many samples are performed. Care must be taken if you see times smaller than a few tenths of nano-seconds. You might be being tricked by compiler optimizations. For example,</p><pre><code class="language-julia-repl hljs">julia&gt; function mysum(x,n)
           s = 0
           for i in 1:n
               s += x
           end
           s
       end

julia&gt; @btime mysum(1,10)
  1.750 ns (0 allocations: 0 bytes)
10

julia&gt; @btime mysum(1,10_000_000)
  1.750 ns (0 allocations: 0 bytes)
10000000
</code></pre><p>clearly the second execution is not doing anything more than the first.  The compiler has realized that doing that loop is not optimal and just performs a multiplication.  </p><h2 id="Functions-that-modify-their-arguments"><a class="docs-heading-anchor" href="#Functions-that-modify-their-arguments">Functions that modify their arguments</a><a id="Functions-that-modify-their-arguments-1"></a><a class="docs-heading-anchor-permalink" href="#Functions-that-modify-their-arguments" title="Permalink"></a></h2><p>Since for each benchmark the function is executed multiple times, things can become tricky if the time required for the execution is dependent on the values of the arguments. These will be changed by the benchmark itself, affecting the outcome.  </p><p>For example, the function below receives to vectors, <code>x</code> and <code>n</code> as parameters, and modifies the two vectors. </p><pre><code class="language-julia-repl hljs">function f!(x,n)
  n[1] = n[1] + 1
  x[n[1]] = 0
end</code></pre><p>A normal execution of this function would be:</p><pre><code class="language-julia-repl hljs">julia&gt; n = [1];

julia&gt; x = [1,2];

julia&gt; f!(x,n);

julia&gt; x
2-element Array{Int64,1}:
 1
 0

julia&gt; n
1-element Array{Int64,1}:
 2
</code></pre><p>The function has modified the vectors and, particular, the vector <code>n</code> has now the element <code>2</code>. If we now execute the same function again, we get an error, because inside the function the element <code>n[1]</code> will assume the value of <code>3</code>, and the vector <code>x</code> only has two positions:</p><pre><code class="language-julia-repl hljs">julia&gt; f!(x,n)
ERROR: BoundsError: attempt to access 2-element Array{Int64,1} at index [3]
</code></pre><p>Therefore, this function cannot be executed twice in a row without redefining the vector <code>n</code> with <code>n[1]=1</code>. This creates a difficulty for running benchmarks:</p><pre><code class="language-julia-repl hljs">julia&gt; n = [1];

julia&gt; x = [1,2];

julia&gt; @btime f!(x,n)
ERROR: BoundsError: attempt to access 2-element Array{Int64,1} at index [3]
</code></pre><p>This is the same error as before, since <code>@btime</code> tried to execute the function multiple times consecutively. </p><p>To address that, we need to explicitly specify that we need each sample of the benchmark to have a single function evaluation, and that the vectors need to be reinitialized before each sample:</p><pre><code class="language-julia-repl hljs">julia&gt; @btime f!($x,n) setup=(n=[1]) evals=1
  51.000 ns (0 allocations: 0 bytes)
2-element Array{Int64,1}:
 1
 0
</code></pre><p>The <code>setup</code> command defines what has to be initialized, and that initialization does not affect the benchmark. The <code>eval=1</code> statement defines that each sample will contain a single function evaluation. </p><p>Note that, in this case, the <code>n</code> parameter of the function is not interpolated (it does not has the <code>$</code>). </p><p>If more than one parameter has to be defined upon initialization, the following syntax is necessary: </p><pre><code class="language-julia-repl hljs">julia&gt; @btime f!($x,n,m) setup=(n=[1]; m=[3,4,5]) evals=1
</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../loopscopes/">« Scope of loops</a><a class="docs-footer-nextpage" href="../assignment/">Assignment and mutation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Friday 8 September 2023 17:43">Friday 8 September 2023</span>. Using Julia version 1.9.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
